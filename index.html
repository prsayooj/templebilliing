<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Pazhangaparambu POS</title>
    
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#f8fafc">
    <meta name="description" content="Temple Billing System">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Temple POS">
    <link rel="apple-touch-icon" href="icon-192.png">

    <style>
        /* RESET & FULLSCREEN */
        * { box-sizing: border-box; }
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; /* Prevents double scrollbars */
            background-color: #f8fafc;
            overscroll-behavior: none; /* Prevents 'pull-to-refresh' bounce */
        }
        
        /* IFRAME OPTIMIZATION */
        iframe {
            border: 0;
            width: 100vw;
            height: 100%; /* Fallback */
            height: 100dvh; /* Dynamic Viewport Height (Best for mobile browsers) */
            display: block;
        }

        /* LOADING SPINNER (Visible until iframe loads) */
        #wrapper-loader {
            position: fixed; inset: 0; z-index: 50;
            background: #f8fafc;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-family: sans-serif; font-size: 12px; color: #64748b; font-weight: bold;
            transition: opacity 0.5s ease;
        }
        .spinner {
            width: 40px; height: 40px; margin-bottom: 10px;
            border: 4px solid #b45309; border-top-color: transparent;
            border-radius: 50%; animation: spin 1s linear infinite;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="wrapper-loader">
        <div class="spinner"></div>
        <div>CONNECTING TO SERVER...</div>
    </div>

    <iframe 
        id="appFrame"
        src="https://script.google.com/macros/s/AKfycbyeThT_oekXyMslcgcWMOpPRUuwu54AMCV6PGJfbg2UP6go-bHsXJy8dbSGmrBz3-XF7g/exec"
        allow="geolocation; camera; microphone" 
        sandbox="sandbox="allow-forms allow-modals allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-top-navigation">
        onload="document.getElementById('wrapper-loader').style.opacity='0'; setTimeout(()=>{document.getElementById('wrapper-loader').style.display='none'},500)"
    ></iframe>

    <script>
        // 1. Service Worker Registration (Required for PWA Install)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
                .then(() => console.log('SW Registered'))
                .catch(err => console.error('SW Failed:', err));
        }

        // 2. Wake Lock (Prevents screen from sleeping during billing - Optional but good for POS)
        /*
        if ('wakeLock' in navigator) {
            let wakeLock = null;
            const requestWakeLock = async () => {
                try { wakeLock = await navigator.wakeLock.request('screen'); } catch (err) {}
            };
            document.addEventListener('visibilitychange', () => {
                if (wakeLock !== null && document.visibilityState === 'visible') requestWakeLock();
            });
            requestWakeLock();
        }
        */
    </script>
</body>
</html>
